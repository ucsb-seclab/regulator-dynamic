"""
bytecodes.py

Author: Robert McLaughlin <robert349@ucsb.edu>

Lists bytecodes for V8 regexp interpreter
"""

import typing

instruction_to_byte = {
    "BREAK": 0,
    "PUSH_CP": 1,
    "PUSH_BT": 2,
    "PUSH_REGISTER": 3,
    "SET_REGISTER_TO_CP": 4,
    "SET_CP_TO_REGISTER": 5,
    "SET_REGISTER_TO_SP": 6,
    "SET_SP_TO_REGISTER": 7,
    "SET_REGISTER": 8,
    "ADVANCE_REGISTER": 9,
    "POP_CP": 10,
    "POP_BT": 11,
    "POP_REGISTER": 12,
    "FAIL": 13,
    "SUCCEED": 14,
    "ADVANCE_CP": 15,
    "GOTO": 16,
    "LOAD_CURRENT_CHAR": 17,
    "LOAD_CURRENT_CHAR_UNCHECKED": 18,
    "LOAD_2_CURRENT_CHARS": 19,
    "LOAD_2_CURRENT_CHARS_UNCHECKED": 20,
    "LOAD_4_CURRENT_CHARS": 21,
    "LOAD_4_CURRENT_CHARS_UNCHECKED": 22,
    "CHECK_4_CHARS": 23,
    "CHECK_CHAR": 24,
    "CHECK_NOT_4_CHARS": 25,
    "CHECK_NOT_CHAR": 26,
    "AND_CHECK_4_CHARS": 27,
    "AND_CHECK_CHAR": 28,
    "AND_CHECK_NOT_4_CHARS": 29,
    "AND_CHECK_NOT_CHAR": 30,
    "MINUS_AND_CHECK_NOT_CHAR": 31,
    "CHECK_CHAR_IN_RANGE": 32,
    "CHECK_CHAR_NOT_IN_RANGE": 33,
    "CHECK_BIT_IN_TABLE": 34,
    "CHECK_LT": 35,
    "CHECK_GT": 36,
    "CHECK_NOT_BACK_REF": 37,
    "CHECK_NOT_BACK_REF_NO_CASE": 38,
    "CHECK_NOT_BACK_REF_NO_CASE_UNICODE": 39,
    "CHECK_NOT_BACK_REF_BACKWARD": 40,
    "CHECK_NOT_BACK_REF_NO_CASE_BACKWARD": 41,
    "CHECK_NOT_BACK_REF_NO_CASE_UNICODE_BACKWARD": 42,
    "CHECK_NOT_REGS_EQUAL": 43,
    "CHECK_REGISTER_LT": 44,
    "CHECK_REGISTER_GE": 45,
    "CHECK_REGISTER_EQ_POS": 46,
    "CHECK_AT_START": 47,
    "CHECK_NOT_AT_START": 48,
    "CHECK_GREEDY": 49,
    "ADVANCE_CP_AND_GOTO": 50,
    "SET_CURRENT_POSITION_FROM_END": 51,
    "CHECK_CURRENT_POSITION": 52,
    "SKIP_UNTIL_BIT_IN_TABLE": 53,
    "SKIP_UNTIL_CHAR_AND": 54,
    "SKIP_UNTIL_CHAR": 55,
    "SKIP_UNTIL_CHAR_POS_CHECKED": 56,
    "SKIP_UNTIL_CHAR_OR_CHAR": 57,
    "SKIP_UNTIL_GT_OR_NOT_BIT_IN_TABLE": 58
}


byte_to_instruction = {}
for k, v in instruction_to_byte.items():
    byte_to_instruction[v] = k


"""
Maps instruction str to width, measured in bytes
"""
instruction_widths = {
    "BREAK": 4,
    "PUSH_CP": 4,
    "PUSH_BT": 8,
    "PUSH_REGISTER": 4,
    "SET_REGISTER_TO_CP": 8,
    "SET_CP_TO_REGISTER": 4,
    "SET_REGISTER_TO_SP": 4,
    "SET_SP_TO_REGISTER": 4,
    "SET_REGISTER": 8,
    "ADVANCE_REGISTER": 8,
    "POP_CP": 4,
    "POP_BT": 4,
    "POP_REGISTER": 4,
    "FAIL": 4,
    "SUCCEED": 4,
    "ADVANCE_CP": 4,
    "GOTO": 8,
    "LOAD_CURRENT_CHAR": 8,
    "LOAD_CURRENT_CHAR_UNCHECKED": 4,
    "LOAD_2_CURRENT_CHARS": 8,
    "LOAD_2_CURRENT_CHARS_UNCHECKED": 4,
    "LOAD_4_CURRENT_CHARS": 8,
    "LOAD_4_CURRENT_CHARS_UNCHECKED": 4,
    "CHECK_4_CHARS": 12,
    "CHECK_CHAR": 8,
    "CHECK_NOT_4_CHARS": 12,
    "CHECK_NOT_CHAR": 8,
    "AND_CHECK_4_CHARS": 16,
    "AND_CHECK_CHAR": 12,
    "AND_CHECK_NOT_4_CHARS": 16,
    "AND_CHECK_NOT_CHAR": 12,
    "MINUS_AND_CHECK_NOT_CHAR": 12,
    "CHECK_CHAR_IN_RANGE": 12,
    "CHECK_CHAR_NOT_IN_RANGE": 12,
    "CHECK_BIT_IN_TABLE": 24,
    "CHECK_LT": 8,
    "CHECK_GT": 8,
    "CHECK_NOT_BACK_REF": 8,
    "CHECK_NOT_BACK_REF_NO_CASE": 8,
    "CHECK_NOT_BACK_REF_NO_CASE_UNICODE": 8,
    "CHECK_NOT_BACK_REF_BACKWARD": 8,
    "CHECK_NOT_BACK_REF_NO_CASE_BACKWARD": 8,
    "CHECK_NOT_BACK_REF_NO_CASE_UNICODE_BACKWARD": 8,
    "CHECK_NOT_REGS_EQUAL": 12,
    "CHECK_REGISTER_LT": 12,
    "CHECK_REGISTER_GE": 12,
    "CHECK_REGISTER_EQ_POS": 8,
    "CHECK_AT_START": 8,
    "CHECK_NOT_AT_START": 8,
    "CHECK_GREEDY": 8,
    "ADVANCE_CP_AND_GOTO": 8,
    "SET_CURRENT_POSITION_FROM_END": 4,
    "CHECK_CURRENT_POSITION": 8,
    "SKIP_UNTIL_BIT_IN_TABLE": 32,
    "SKIP_UNTIL_CHAR_AND": 24,
    "SKIP_UNTIL_CHAR": 16,
    "SKIP_UNTIL_CHAR_POS_CHECKED": 20,
    "SKIP_UNTIL_CHAR_OR_CHAR": 20,
    "SKIP_UNTIL_GT_OR_NOT_BIT_IN_TABLE": 32,
}
